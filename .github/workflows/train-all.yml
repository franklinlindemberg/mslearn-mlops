name: Run experiments

on:
  pull_request:
    branches:
      - main

jobs:
  create-endpoint:
    uses: ./.github/workflows/register-job.yml
    needs: experimentation
    with:
      run_id: ${{needs.experimentation.outputs.run_id}}
      environment: development
    secrets:
      AZURE_CREDENTIALS: ${{secrets.AZURE_CREDENTIALS}}
  experimentation:
    uses: ./.github/workflows/train-job.yml
    with:
      dataset: experimentation
      environment: development
    secrets:
      AZURE_CREDENTIALS: ${{secrets.AZURE_CREDENTIALS}}
  deploy-model:
    uses: ./.github/workflows/deploy-model.yml
    needs: experimentation
    with:
      run_id: ${{needs.experimentation.outputs.run_id}}
      environment: development
    secrets:
      AZURE_CREDENTIALS: ${{secrets.AZURE_CREDENTIALS}}
  production:
    uses: ./.github/workflows/train-job.yml
    needs: experimentation
    with:
      dataset: production
      environment: production
    secrets:
      AZURE_CREDENTIALS: ${{secrets.AZURE_CREDENTIALS}}
#  register-model:
#    runs-on: ubuntu-latest
#    environment: production
#    needs: experimentation
#    steps:
#      - name: echo
#        uses: ${{needs.production.outputs.step}}
